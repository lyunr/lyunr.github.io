<!-- redirect.html 完整代码 -->
<!DOCTYPE html>
<html>
<head>
    <title>跳转引导页</title>
    <style>
        /* 保留之前所有的样式 */
        body { margin: 0; padding: 0; font-family: sans-serif; }
        .weixin-guide { display: none; flex-direction: column; align-items: center; padding: 20px; height: 100vh; }
        /* 其他样式保持不变... */
    </style>
</head>
<body>
    <div id="weixinGuide" class="weixin-guide">
        <img src="/guide-top.png" class="guide-image top">
        <p class="guide-text">请点击右上角 <span>···</span> 选择"在浏览器中打开"</p>
        <img src="/guide-bottom.png" class="guide-image bottom">
    </div>

    <script>
        // 1. 从URL参数获取目标链接
        const params = new URLSearchParams(window.location.search);
        let targetUrl = params.get('target') || 'https://默认目标.com';
        
        // 2. 验证URL安全性
        if(!isValidUrl(targetUrl)) {
            targetUrl = 'https://默认目标.com';
        }

        // 3. 保留原有跳转逻辑（修改getTargetUrl函数）
        function getTargetUrl() {
            const random = Math.floor(Math.random() * 900) + 100;
            return `${targetUrl}${targetUrl.includes('?') ? '&' : '?'}t=${random}`;
        }

        // 4. 保留其他原有函数（isWeixinBrowser等）
        function isWeixinBrowser() {
            return /MicroMessenger/i.test(navigator.userAgent);
        }

        // 5. 安全验证函数
        function isValidUrl(url) {
            try {
                new URL(url);
                return url.startsWith('http://') || url.startsWith('https://');
            } catch {
                return false;
            }
        }

        // 6. 初始化逻辑保持不变
        window.onload = function() {
            if(isWeixinBrowser()) {
                document.getElementById('weixinGuide').style.display = 'flex';
            } else {
                window.location.href = getTargetUrl();
            }
        };
    </script>
</body>
</html>
