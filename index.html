<script>
// 配置Cloudflare Worker代理地址
const WORKER_URL = 'https://winter-disk-bcce.tiktokfeng.workers.dev';

async function handleRedirect() {
    const targetUrl = getTargetUrl(); // 解析Base64参数
    
    // 判断目标域名选择策略
    if (targetUrl.includes('lyyzs.xyz')) {
        // 严格防护网站：使用Worker代理 + 新窗口打开
        const proxyUrl = `${WORKER_URL}/?url=${encodeURIComponent(targetUrl)}`;
        
        // 方法1: 尝试iframe嵌套（带防护绕过）
        const iframe = document.createElement('iframe');
        iframe.srcdoc = `
            <!DOCTYPE html>
            <html>
            <head>
                <script>
                    // 解除防护检测
                    Object.defineProperty(window, 'top', { value: window });
                    window.frameElement = null;
                <\/script>
                <meta http-equiv="refresh" content="0;url=${proxyUrl}">
            </head>
            <body></body>
            </html>
        `;
        document.body.appendChild(iframe);
        
        // 方法2: 5秒后降级为新窗口打开
        setTimeout(() => {
            if (!iframe.contentWindow?.location.href) {
                window.open(proxyUrl, '_blank', 'noopener=yes');
            }
        }, 5000);
        
    } else {
        // 普通网站：原始iframe方案
        location.href = `/proxy.html#${encodeURIComponent(targetUrl)}`;
    }
}
</script>
